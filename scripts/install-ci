#!/bin/bash
### --------------------------------------------------------------------
### install-ci
### --------------------------------------------------------------------

# Exit on error
set -e

. vconan/bin/activate
cd packages/arb-avm-cpp
mkdir -p ci build
cd ci
conan install .. -s compiler.libcxx=libstdc++11
cmake -DCMAKE_BUILD_TYPE=Debug -DCODE_COVERAGE=True ..
cmake --build .
cd ../build
conan install .. -s compiler.libcxx=libstdc++11
cmake -DCMAKE_BUILD_TYPE=${CMAKE_BUILD_TYPE} ..
cmake --build .
deactivate
cd ../../..

# Install arb-compiler-evm
cd packages/arb-compiler-evm
pip3 install -r requirements.txt --user
python3 setup.py install --user
cd ../..

# install arb-validator
cd packages/arb-validator
go mod download
go install -v ./...
cd ../..
